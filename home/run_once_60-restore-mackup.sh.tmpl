{{- if and (eq .chezmoi.os "darwin") (not (index . "headless" | default false)) -}}
#!/usr/bin/env bash

# Mackup Configuration Restore
# Restores application settings and configurations from cloud storage

set -euo pipefail

# Check if mackup is installed
if ! command -v mackup >/dev/null 2>&1; then
    echo "âš ï¸  Mackup not installed. Installing via Homebrew..."
    if command -v brew >/dev/null 2>&1; then
        brew install mackup
    else
        echo "âŒ Homebrew not available. Skipping mackup setup."
        exit 0
    fi
fi

# Check if mackup configuration exists
if [[ ! -f "$HOME/.mackup.cfg" ]]; then
    echo "ðŸ“‹ Creating basic mackup configuration..."
    cat >"$HOME/.mackup.cfg" <<'EOF'
[storage]
engine = icloud

[applications_to_ignore]
# Add applications you don't want to sync
# ssh
EOF
    echo "âœ… Created ~/.mackup.cfg"
    echo "ðŸ’¡ Edit ~/.mackup.cfg to customize sync settings"
fi

# Note: Actual restore requires user interaction
# Run manually: mackup restore
echo "â„¹ï¸  Mackup is configured. Run 'mackup restore' manually to restore configurations."
{{- end -}}
