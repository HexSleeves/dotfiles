#!/bin/bash
{{- if or (eq .chezmoi.os "darwin") (eq .chezmoi.os "linux") }}

# Install additional zsh conf.d files
{{ if stat "dot_config/dotfiles/encrypted_ai-providers.local.zsh.asc" -}}
# Hash: {{ include "dot_config/dotfiles/encrypted_ai-providers.local.zsh.asc" | sha256sum }}
{{ end -}}

set -euo pipefail

CONF_DIR="$HOME/.config/zsh/conf.d"

# Create conf.d if it doesn't exist (zdotdir external should create .config/zsh)
mkdir -p "$CONF_DIR"

# Copy optional local zsh configs if present.
for name in ai-providers.local.zsh nvm.zsh; do
    SOURCE_FILE="$HOME/.config/dotfiles/$name"
    if [[ ! -f "$SOURCE_FILE" ]]; then
        continue
    fi

    TARGET_NAME="$name"
    if [[ "$name" == "nvm.zsh" ]]; then
        # The external zdotdir ignores conf.d/nvm.zsh, so install under a different name.
        TARGET_NAME="nvm.local.zsh"
    fi

    echo "Installing $name to $CONF_DIR/$TARGET_NAME..."
    cp "$SOURCE_FILE" "$CONF_DIR/$TARGET_NAME"
    echo "Installed $TARGET_NAME"
done
{{- end }}
